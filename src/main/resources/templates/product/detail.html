<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Product Detail</title>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
</head>
<body>
    <h1>Product Detail</h1>
    <a href="/">Home</a> | <a href="/products">Back to List</a>
    | <a th:href="@{/stock/product/{id}(id=${product.id()})}">Stock Entries</a>

    <div th:if="${error}" style="color:red;" th:text="${error}"></div>

    <h2>Info</h2>
    <p>ID: <span th:text="${product.id()}"></span></p>
    <p>Name: <span th:text="${product.name()}"></span></p>
    <p>SKU: <span th:text="${product.sku()}"></span></p>
    <p>Barcode: <span th:text="${product.barcode()}"></span></p>
    <p>Type: <span th:text="${product.productType() != null ? product.productType().name() : ''}"></span></p>
    <p>Sale Price: <span th:text="${product.salePrice()}"></span></p>
    <p>Cost Price: <span th:text="${product.costPrice()}"></span></p>
    <p>Stock Quantity: <span th:text="${product.stockQuantity()}"></span></p>
    <p>Weight: <span th:text="${product.weight()}"></span> kg</p>
    <p>Active: <span th:text="${product.isActive()}"></span></p>

    <h3>Categories</h3>
    <ul th:if="${product.categories() != null}">
        <li th:each="cat : ${product.categories()}" th:text="${cat.name()}"></li>
    </ul>

    <h3>Dimensions</h3>
    <p>Height: <span th:text="${product.height()}"></span></p>
    <p>Width: <span th:text="${product.width()}"></span></p>
    <p>Length: <span th:text="${product.length()}"></span></p>
    <p>Depth: <span th:text="${product.depth()}"></span></p>

    <h3>Activate/Deactivate</h3>
    <form method="post" th:action="@{/products/{id}/activate(id=${product.id()})}" th:unless="${product.isActive()}">
        <label>Reason: <input type="text" name="reason" required/></label>
        <label>Category:
            <select name="category">
                <option th:each="c : ${statusChangeCategories}" th:value="${c}" th:text="${c}"></option>
            </select>
        </label>
        <button type="submit">Activate</button>
    </form>

    <h3>Status History</h3>
    <table border="1" th:if="${product.statusChanges() != null && !product.statusChanges().isEmpty()}">
        <thead><tr><th>Type</th><th>Reason</th><th>Category</th><th>Date</th></tr></thead>
        <tbody>
            <tr th:each="sc : ${product.statusChanges()}">
                <td th:text="${sc.type()}"></td>
                <td th:text="${sc.reason()}"></td>
                <td th:text="${sc.category()}"></td>
                <td th:text="${sc.changedAt()}"></td>
            </tr>
        </tbody>
    </table>
</body>
</html>
