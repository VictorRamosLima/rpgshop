<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: page('Editar Produto', ~{::main-content})}">
<div th:fragment="main-content">
    <nav class="breadcrumb-nav" aria-label="Breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Inicio</a></li>
            <li class="breadcrumb-item"><a href="/products">Produtos</a></li>
            <li class="breadcrumb-item"><a th:href="@{/products/{id}(id=${product.id()})}">Detalhe</a></li>
            <li class="breadcrumb-item" aria-current="page">Editar</li>
        </ol>
    </nav>

    <header class="page-header">
        <div>
            <h1 class="page-title">Editar Produto</h1>
            <p class="page-subtitle">Atualize os dados cadastrais e, se necessario, o preco de venda com autorizacao gerencial.</p>
        </div>
    </header>

    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <form method="post" th:action="@{/products/{id}/update(id=${product.id()})}">
        <section class="card">
            <div class="card-title">Dados principais</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Nome (obrigatorio)</label>
                    <input id="name" type="text" name="name" th:value="${product.name()}" required />
                </div>
                <div class="form-group">
                    <label for="productTypeId">Tipo (obrigatorio)</label>
                    <select id="productTypeId" name="productTypeId" required>
                        <option value="">Selecione...</option>
                        <option th:each="pt : ${productTypes}"
                                th:value="${pt.id()}"
                                th:text="${pt.name()}"
                                th:selected="${product.productType() != null and product.productType().id() == pt.id()}">
                        </option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="categoryIds">Categorias (obrigatorio)</label>
                    <select id="categoryIds" name="categoryIds" multiple required size="6">
                        <option th:each="cat : ${categories}"
                                th:value="${cat.id()}"
                                th:text="${cat.name()}"
                                th:selected="${selectedCategoryIds != null and selectedCategoryIds.contains(cat.id())}">
                        </option>
                    </select>
                    <span class="form-hint">Use Ctrl/Cmd para selecionar mais de uma categoria.</span>
                </div>
                <div class="form-group">
                    <label for="pricingGroupId">Grupo de precificacao (obrigatorio)</label>
                    <select id="pricingGroupId" name="pricingGroupId" required>
                        <option value="">Selecione...</option>
                        <option th:each="pg : ${pricingGroups}"
                                th:value="${pg.id()}"
                                th:text="${pg.name()}"
                                th:selected="${product.pricingGroup() != null and product.pricingGroup().id() == pg.id()}">
                        </option>
                    </select>
                </div>
            </div>
        </section>

        <section class="card">
            <div class="card-title">Especificacoes</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="height">Altura (obrigatorio)</label>
                    <input id="height" type="number" step="0.01" min="0.01" name="height" th:value="${product.height()}" required />
                </div>
                <div class="form-group">
                    <label for="width">Largura (obrigatorio)</label>
                    <input id="width" type="number" step="0.01" min="0.01" name="width" th:value="${product.width()}" required />
                </div>
                <div class="form-group">
                    <label for="depth">Profundidade (obrigatorio)</label>
                    <input id="depth" type="number" step="0.01" min="0.01" name="depth" th:value="${product.depth()}" required />
                </div>
                <div class="form-group">
                    <label for="weight">Peso (obrigatorio)</label>
                    <input id="weight" type="number" step="0.01" min="0.01" name="weight" th:value="${product.weight()}" required />
                </div>
            </div>
        </section>

        <section class="card">
            <div class="card-title">Identificadores e precos</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="sku">SKU</label>
                    <input id="sku" type="text" name="sku" th:value="${product.sku()}" />
                </div>
                <div class="form-group">
                    <label for="barcode">Codigo de barras</label>
                    <input id="barcode" type="text" name="barcode" th:value="${product.barcode()}" />
                </div>
                <div class="form-group">
                    <label for="costPrice">Preco de custo (obrigatorio)</label>
                    <input id="costPrice" type="number" step="0.01" min="0.01" name="costPrice" th:value="${product.costPrice()}" required />
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="salePrice">Preco de venda (opcional)</label>
                    <input id="salePrice" type="number" step="0.01" min="0.01" name="salePrice" th:value="${product.salePrice()}" />
                    <span class="form-hint">Deixe em branco para recalcular automaticamente pela margem do grupo.</span>
                </div>
                <div class="form-group" style="display:flex;align-items:flex-end;">
                    <label style="display:flex;gap:0.5rem;align-items:center;">
                        <input type="checkbox" name="managerAuthorized" value="true" />
                        Autorizacao gerencial para preco abaixo da margem
                    </label>
                </div>
            </div>
        </section>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-lg">Salvar Alteracoes</button>
            <a th:href="@{/products/{id}(id=${product.id()})}" class="btn btn-outline btn-lg">Cancelar</a>
        </div>
    </form>
</div>
</html>
