<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: page('Produtos', ~{::main-content})}">
<div th:fragment="main-content">

    <div class="breadcrumb">
        <a href="/">Início</a> <span>/</span> <span>Produtos</span>
    </div>

    <div class="page-header">
        <h1>&#127922; Catálogo de Produtos</h1>
    </div>

    <div class="filter-bar">
        <form method="get" action="/products" class="form-inline">
            <div class="form-group">
                <label>Nome</label>
                <input type="text" name="name" th:value="${param.name}" placeholder="Buscar por nome..."/>
            </div>
            <div class="form-group">
                <label>Status</label>
                <select name="isActive">
                    <option value="">Todos</option>
                    <option value="true" th:selected="${param.isActive != null && param.isActive.toString() == 'true'}">Ativo</option>
                    <option value="false" th:selected="${param.isActive != null && param.isActive.toString() == 'false'}">Inativo</option>
                </select>
            </div>
            <div class="form-group">
                <label>Preço Mín.</label>
                <input type="number" step="0.01" name="minPrice" th:value="${param.minPrice}" placeholder="R$ 0,00"/>
            </div>
            <div class="form-group">
                <label>Preço Máx.</label>
                <input type="number" step="0.01" name="maxPrice" th:value="${param.maxPrice}" placeholder="R$ 999,99"/>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Filtrar</button>
            </div>
        </form>
    </div>

    <div th:if="${products != null && !products.content.isEmpty()}">
        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>SKU</th>
                    <th>Preço de Venda</th>
                    <th>Estoque</th>
                    <th>Status</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="product : ${products.content}">
                    <td th:text="${product.name()}"></td>
                    <td th:text="${product.sku()}"></td>
                    <td>
                        <span class="info-value price" th:text="'R$ ' + ${#numbers.formatDecimal(product.salePrice(), 1, 2)}"></span>
                    </td>
                    <td th:text="${product.stockQuantity()}"></td>
                    <td>
                        <span th:if="${product.isActive()}" class="badge badge-active">Ativo</span>
                        <span th:unless="${product.isActive()}" class="badge badge-inactive">Inativo</span>
                    </td>
                    <td class="actions-cell">
                        <a th:href="@{/products/{id}(id=${product.id()})}" class="btn btn-sm btn-outline">Detalhes</a>
                        <a th:href="@{/stock/product/{id}(id=${product.id()})}" class="btn btn-sm btn-accent">Estoque</a>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="pagination" th:if="${products.totalPages > 1}">
            <span th:each="i : ${#numbers.sequence(0, products.totalPages - 1)}">
                <a th:href="@{/products(page=${i}, name=${param.name}, isActive=${param.isActive}, minPrice=${param.minPrice}, maxPrice=${param.maxPrice})}"
                   th:text="${i + 1}"
                   th:if="${i != products.number}"></a>
                <strong th:text="${i + 1}" th:if="${i == products.number}"></strong>
            </span>
        </div>
    </div>

    <div th:if="${products == null || products.content.isEmpty()}" class="empty-state">
        <div class="empty-state-icon">&#128270;</div>
        <div class="empty-state-text">Nenhum produto encontrado</div>
        <p>Tente ajustar os filtros de busca.</p>
    </div>

</div>
</html>
