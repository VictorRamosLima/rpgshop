<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Exchange Detail</title>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
</head>
<body>
    <h1>Exchange Detail</h1>
    <a href="/">Home</a> | <a href="/exchanges">Back to Exchanges</a>

    <div th:if="${error}" style="color:red;" th:text="${error}"></div>

    <h2>Info</h2>
    <p>ID: <span th:text="${exchange.id()}"></span></p>
    <p>Status: <span th:text="${exchange.status()}"></span></p>
    <p>Quantity: <span th:text="${exchange.quantity()}"></span></p>
    <p>Reason: <span th:text="${exchange.reason()}"></span></p>
    <p>Order: <a th:href="@{/orders/{id}(id=${exchange.order().id()})}" th:text="${exchange.order().id()}"></a></p>
    <p>Product: <span th:text="${exchange.orderItem() != null && exchange.orderItem().product() != null ? exchange.orderItem().product().name() : ''}"></span></p>
    <p th:if="${exchange.authorizedAt() != null}">Authorized At: <span th:text="${exchange.authorizedAt()}"></span></p>
    <p th:if="${exchange.receivedAt() != null}">Received At: <span th:text="${exchange.receivedAt()}"></span></p>
    <p>Return to Stock: <span th:text="${exchange.returnToStock()}"></span></p>
    <p th:if="${exchange.coupon() != null}">Coupon: <span th:text="${exchange.coupon().code()}"></span> (Value: <span th:text="${exchange.coupon().value()}"></span>)</p>

    <h3>Actions</h3>
    <div>
        <form method="post" th:action="@{/exchanges/{id}/authorize(id=${exchange.id()})}" style="display:inline;"
              th:if="${exchange.status().name() == 'REQUESTED'}">
            <button type="submit">Authorize</button>
        </form>
        <form method="post" th:action="@{/exchanges/{id}/deny(id=${exchange.id()})}" style="display:inline;"
              th:if="${exchange.status().name() == 'REQUESTED'}">
            <button type="submit">Deny</button>
        </form>
        <form method="post" th:action="@{/exchanges/{id}/receive(id=${exchange.id()})}"
              th:if="${exchange.status().name() == 'AUTHORIZED'}">
            <label>Return to Stock: <input type="checkbox" name="returnToStock" value="true"/></label>
            <button type="submit">Receive Items</button>
        </form>
    </div>
</body>
</html>
