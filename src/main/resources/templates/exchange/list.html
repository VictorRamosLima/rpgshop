<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Exchange Requests</title>
    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
</head>
<body>
    <h1>Exchange Requests</h1>
    <a href="/">Home</a>

    <h2>Filter</h2>
    <form method="get" action="/exchanges">
        <label>Status:
            <select name="status">
                <option value="">All</option>
                <option th:each="s : ${statuses}" th:value="${s}" th:text="${s}" th:selected="${param.status != null && param.status.toString() == s.toString()}"></option>
            </select>
        </label>
        <button type="submit">Filter</button>
    </form>

    <h2>Results</h2>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Order</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Reason</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="exchange : ${exchanges.content}">
                <td th:text="${#strings.substring(exchange.id().toString(), 0, 8)}"></td>
                <td th:text="${exchange.order() != null ? #strings.substring(exchange.order().id().toString(), 0, 8) : ''}"></td>
                <td th:text="${exchange.orderItem() != null && exchange.orderItem().product() != null ? exchange.orderItem().product().name() : ''}"></td>
                <td th:text="${exchange.quantity()}"></td>
                <td th:text="${exchange.status()}"></td>
                <td th:text="${exchange.reason()}"></td>
                <td>
                    <a th:href="@{/exchanges/{id}(id=${exchange.id()})}">View</a>
                </td>
            </tr>
        </tbody>
    </table>

    <div th:if="${exchanges.totalPages > 1}">
        <span th:each="i : ${#numbers.sequence(0, exchanges.totalPages - 1)}">
            <a th:href="@{/exchanges(page=${i}, status=${param.status})}"
               th:text="${i + 1}"
               th:if="${i != exchanges.number}"></a>
            <strong th:text="${i + 1}" th:if="${i == exchanges.number}"></strong>
        </span>
    </div>
</body>
</html>
